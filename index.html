<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Профессиональный Генератор Паролей</title>
    <style>
        /* === Стили (200+ строк) === */
        :root {
            --primary-color: #4a6fa5;
            --secondary-color: #166088;
            --accent-color: #4fc3f7;
            --background-color: #f5f7fa;
            --text-color: #333;
            --error-color: #e74c3c;
            --success-color: #2ecc71;
            --warning-color: #f39c12;
        }
        
        * {
            box-sizing: border-box;
            margin: 0;
            padding: 0;
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
        }
        
        body {
            background-color: var(--background-color);
            color: var(--text-color);
            line-height: 1.6;
            padding: 20px;
            min-height: 100vh;
            display: flex;
            flex-direction: column;
            align-items: center;
        }
        
        .container {
            max-width: 900px;
            width: 100%;
            background: white;
            border-radius: 10px;
            box-shadow: 0 5px 15px rgba(0, 0, 0, 0.1);
            padding: 30px;
            margin: 20px 0;
        }
        
        h1 {
            color: var(--primary-color);
            text-align: center;
            margin-bottom: 30px;
            font-size: 2.5rem;
        }
        
        .description {
            text-align: center;
            margin-bottom: 30px;
            color: #666;
            font-size: 1.1rem;
        }
        
        .settings-panel {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
            margin-bottom: 30px;
        }
        
        .settings-group {
            background: #f9f9f9;
            border-radius: 8px;
            padding: 20px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
        }
        
        .settings-group h2 {
            color: var(--secondary-color);
            margin-bottom: 15px;
            font-size: 1.3rem;
            border-bottom: 1px solid #eee;
            padding-bottom: 10px;
        }
        
        .option {
            margin-bottom: 15px;
            display: flex;
            align-items: center;
        }
        
        .option label {
            margin-left: 10px;
            cursor: pointer;
            flex-grow: 1;
        }
        
        .option input[type="checkbox"] {
            cursor: pointer;
            width: 18px;
            height: 18px;
        }
        
        .option input[type="number"] {
            width: 70px;
            padding: 8px;
            border: 1px solid #ddd;
            border-radius: 4px;
            margin-left: 10px;
        }
        
        .slider-container {
            width: 100%;
            margin-top: 10px;
        }
        
        .slider {
            -webkit-appearance: none;
            width: 100%;
            height: 8px;
            border-radius: 5px;
            background: #ddd;
            outline: none;
            margin-bottom: 15px;
        }
        
        .slider::-webkit-slider-thumb {
            -webkit-appearance: none;
            appearance: none;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
        }
        
        .slider::-moz-range-thumb {
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: var(--primary-color);
            cursor: pointer;
        }
        
        .btn {
            background-color: var(--primary-color);
            color: white;
            border: none;
            padding: 12px 25px;
            font-size: 1.1rem;
            border-radius: 5px;
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-block;
            text-align: center;
        }
        
        .btn:hover {
            background-color: var(--secondary-color);
            transform: translateY(-2px);
            box-shadow: 0 5px 10px rgba(0, 0, 0, 0.1);
        }
        
        .btn:active {
            transform: translateY(0);
        }
        
        .btn-large {
            padding: 15px 30px;
            font-size: 1.2rem;
        }
        
        .btn-block {
            display: block;
            width: 100%;
        }
        
        .result-container {
            margin-top: 30px;
        }
        
        .password-result {
            width: 100%;
            padding: 15px;
            font-size: 1.2rem;
            border: 1px solid #ddd;
            border-radius: 5px;
            background: #f9f9f9;
            margin-bottom: 15px;
            word-break: break-all;
            text-align: center;
            font-family: 'Courier New', monospace;
        }
        
        .password-strength {
            height: 10px;
            border-radius: 5px;
            margin-bottom: 20px;
            background: #eee;
            overflow: hidden;
        }
        
        .strength-bar {
            height: 100%;
            width: 0%;
            transition: all 0.3s ease;
        }
        
        .strength-weak {
            background-color: var(--error-color);
        }
        
        .strength-medium {
            background-color: var(--warning-color);
        }
        
        .strength-strong {
            background-color: var(--success-color);
        }
        
        .strength-very-strong {
            background-color: #27ae60;
        }
        
        .strength-label {
            text-align: center;
            font-weight: bold;
            margin-bottom: 10px;
        }
        
        .password-history {
            margin-top: 30px;
            max-height: 300px;
            overflow-y: auto;
            border: 1px solid #ddd;
            border-radius: 5px;
            padding: 10px;
            background: #f9f9f9;
        }
        
        .history-item {
            padding: 10px;
            border-bottom: 1px solid #eee;
            font-family: 'Courier New', monospace;
            display: flex;
            justify-content: space-between;
        }
        
        .history-item:last-child {
            border-bottom: none;
        }
        
        .copy-btn {
            background: none;
            border: none;
            color: var(--primary-color);
            cursor: pointer;
            font-size: 0.9rem;
        }
        
        .copy-btn:hover {
            text-decoration: underline;
        }
        
        .tabs {
            display: flex;
            margin-bottom: 20px;
            border-bottom: 1px solid #ddd;
        }
        
        .tab {
            padding: 10px 20px;
            cursor: pointer;
            background: #f1f1f1;
            border: 1px solid #ddd;
            border-bottom: none;
            border-radius: 5px 5px 0 0;
            margin-right: 5px;
        }
        
        .tab.active {
            background: white;
            border-bottom: 1px solid white;
            margin-bottom: -1px;
            font-weight: bold;
            color: var(--primary-color);
        }
        
        .tab-content {
            display: none;
        }
        
        .tab-content.active {
            display: block;
        }
        
        .advanced-options {
            margin-top: 20px;
            padding: 15px;
            background: #f5f5f5;
            border-radius: 5px;
            border-left: 4px solid var(--primary-color);
        }
        
        .password-list {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(250px, 1fr));
            gap: 15px;
            margin-top: 20px;
        }
        
        .password-item {
            padding: 15px;
            background: white;
            border-radius: 5px;
            box-shadow: 0 2px 5px rgba(0, 0, 0, 0.05);
            font-family: 'Courier New', monospace;
            word-break: break-all;
            border: 1px solid #eee;
        }
        
        .footer {
            text-align: center;
            margin-top: 30px;
            color: #777;
            font-size: 0.9rem;
        }
        
        @media (max-width: 768px) {
            .settings-panel {
                grid-template-columns: 1fr;
            }
            
            .password-list {
                grid-template-columns: 1fr;
            }
        }
        
        /* Анимации */
        @keyframes fadeIn {
            from { opacity: 0; }
            to { opacity: 1; }
        }
        
        .fade-in {
            animation: fadeIn 0.5s ease-in;
        }
        
        /* Дополнительные стили для улучшения UX */
        .tooltip {
            position: relative;
            display: inline-block;
            margin-left: 5px;
            color: var(--primary-color);
            cursor: help;
        }
        
        .tooltip .tooltiptext {
            visibility: hidden;
            width: 200px;
            background-color: #555;
            color: #fff;
            text-align: center;
            border-radius: 6px;
            padding: 5px;
            position: absolute;
            z-index: 1;
            bottom: 125%;
            left: 50%;
            margin-left: -100px;
            opacity: 0;
            transition: opacity 0.3s;
            font-size: 0.9rem;
        }
        
        .tooltip:hover .tooltiptext {
            visibility: visible;
            opacity: 1;
        }
        
        /* Стили для иконок (используем Unicode символы) */
        .icon {
            font-size: 1.2em;
            vertical-align: middle;
        }
        
        /* Стили для темной темы */
        @media (prefers-color-scheme: dark) {
            :root {
                --background-color: #121212;
                --text-color: #e0e0e0;
                --primary-color: #bb86fc;
                --secondary-color: #3700b3;
                --accent-color: #03dac6;
            }
            
            body {
                background-color: var(--background-color);
            }
            
            .container, .settings-group, .password-result, .password-history, .password-item {
                background-color: #1e1e1e;
                color: var(--text-color);
            }
            
            .settings-group, .password-result, .password-history, .password-item {
                border-color: #333;
            }
            
            .option input[type="number"], .password-result {
                background-color: #2d2d2d;
                color: var(--text-color);
                border-color: #444;
            }
            
            .slider {
                background: #555;
            }
            
            .tab {
                background: #333;
                color: var(--text-color);
                border-color: #444;
            }
            
            .tab.active {
                background: #1e1e1e;
                color: var(--primary-color);
            }
            
            .advanced-options {
                background: #2d2d2d;
                border-left-color: var(--primary-color);
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>🔐 Профессиональный Генератор Паролей</h1>
        <p class="description">Создавайте безопасные, уникальные пароли для всех ваших учетных записей</p>
        
        <div class="tabs">
            <div class="tab active" onclick="openTab('simple')">Простой</div>
            <div class="tab" onclick="openTab('advanced')">Продвинутый</div>
            <div class="tab" onclick="openTab('batch')">Пакетный</div>
        </div>
        
        <!-- Простой режим -->
        <div id="simple" class="tab-content active">
            <div class="settings-panel">
                <div class="settings-group">
                    <h2>Основные настройки</h2>
                    <div class="option">
                        <input type="number" id="length" min="4" max="128" value="12">
                        <label for="length">Длина пароля</label>
                    </div>
                    <div class="slider-container">
                        <input type="range" min="4" max="128" value="12" class="slider" id="lengthSlider">
                    </div>
                    <div class="option">
                        <input type="checkbox" id="uppercase" checked>
                        <label for="uppercase">Заглавные буквы (A-Z)</label>
                    </div>
                    <div class="option">
                        <input type="checkbox" id="lowercase" checked>
                        <label for="lowercase">Строчные буквы (a-z)</label>
                    </div>
                    <div class="option">
                        <input type="checkbox" id="numbers" checked>
                        <label for="numbers">Цифры (0-9)</label>
                    </div>
                    <div class="option">
                        <input type="checkbox" id="symbols" checked>
                        <label for="symbols">Спецсимволы (!@#$%^&*)</label>
                    </div>
                </div>
                
                <div class="settings-group">
                    <h2>Дополнительные настройки</h2>
                    <div class="option">
                        <input type="checkbox" id="noSimilar" checked>
                        <label for="noSimilar">Исключать похожие символы (i,l,1,L,o,0,O)</label>
                    </div>
                    <div class="option">
                        <input type="checkbox" id="noAmbiguous" checked>
                        <label for="noAmbiguous">Исключать неоднозначные символы ({ } [ ] ( ) / \ ' " ` ~ , ; : . &lt; >)</label>
                    </div>
                    <div class="option">
                        <input type="checkbox" id="noSequential">
                        <label for="noSequential">Исключать последовательные символы (123, abc)</label>
                    </div>
                    <div class="option">
                        <input type="checkbox" id="noRepeating">
                        <label for="noRepeating">Исключать повторяющиеся символы (aa, 11)</label>
                    </div>
                    <div class="option">
                        <input type="checkbox" id="requireAll">
                        <label for="requireAll">Обязательно включать все выбранные типы символов</label>
                    </div>
                </div>
            </div>
            
            <button id="generateBtn" class="btn btn-large btn-block">Сгенерировать пароль</button>
            
            <div class="result-container">
                <div class="password-strength">
                    <div class="strength-bar" id="strengthBar"></div>
                </div>
                <div class="strength-label" id="strengthLabel">Надежность: -</div>
                <textarea class="password-result" id="passwordResult" readonly></textarea>
                <button id="copyBtn" class="btn">Копировать пароль</button>
                <button id="saveBtn" class="btn">Сохранить в историю</button>
            </div>
            
            <div class="password-history" id="passwordHistory">
                <h3>История паролей</h3>
                <div id="historyList"></div>
                <button id="clearHistoryBtn" class="btn">Очистить историю</button>
            </div>
        </div>
        
        <!-- Продвинутый режим -->
        <div id="advanced" class="tab-content">
            <div class="settings-panel">
                <div class="settings-group">
                    <h2>Настройки символов</h2>
                    <div class="option">
                        <input type="number" id="advLength" min="4" max="256" value="16">
                        <label for="advLength">Длина пароля</label>
                    </div>
                    <div class="option">
                        <input type="text" id="customChars" placeholder="Введите свои символы">
                        <label for="customChars">Пользовательские символы</label>
                    </div>
                    <div class="option">
                        <input type="checkbox" id="excludeChars">
                        <label for="excludeChars">Исключить следующие символы:</label>
                    </div>
                    <div class="option">
                        <input type="text" id="excludedChars" placeholder="i,l,1,L,o,0,O">
                    </div>
                </div>
                
                <div class="settings-group">
                    <h2>Шаблоны паролей</h2>
                    <div class="option">
                        <input type="text" id="passwordPattern" placeholder="Например: CccddssCccddss">
                        <label for="passwordPattern">Шаблон пароля <span class="tooltip">?<span class="tooltiptext">C=заглавная, c=строчная, d=цифра, s=спецсимвол</span></span></label>
                    </div>
                    <div class="option">
                        <input type="checkbox" id="usePattern">
                        <label for="usePattern">Использовать шаблон</label>
                    </div>
                    <div class="option">
                        <input type="checkbox" id="pronounceable">
                        <label for="pronounceable">Произносимый пароль</label>
                    </div>
                    <div class="option">
                        <input type="checkbox" id="memorable">
                        <label for="memorable">Запоминающийся пароль</label>
                    </div>
                </div>
            </div>
            
            <div class="advanced-options">
                <h3>Дополнительные опции</h3>
                <div class="option">
                    <input type="number" id="minUpper" min="0" max="10" value="1">
                    <label for="minUpper">Минимум заглавных букв</label>
                </div>
                <div class="option">
                    <input type="number" id="minLower" min="0" max="10" value="1">
                    <label for="minLower">Минимум строчных букв</label>
                </div>
                <div class="option">
                    <input type="number" id="minNumbers" min="0" max="10" value="1">
                    <label for="minNumbers">Минимум цифр</label>
                </div>
                <div class="option">
                    <input type="number" id="minSymbols" min="0" max="10" value="1">
                    <label for="minSymbols">Минимум спецсимволов</label>
                </div>
            </div>
            
            <button id="generateAdvBtn" class="btn btn-large btn-block">Сгенерировать продвинутый пароль</button>
            
            <div class="result-container">
                <div class="password-strength">
                    <div class="strength-bar" id="advStrengthBar"></div>
                </div>
                <div class="strength-label" id="advStrengthLabel">Надежность: -</div>
                <textarea class="password-result" id="advPasswordResult" readonly></textarea>
                <button id="copyAdvBtn" class="btn">Копировать пароль</button>
            </div>
        </div>
        
        <!-- Пакетный режим -->
        <div id="batch" class="tab-content">
            <div class="settings-panel">
                <div class="settings-group">
                    <h2>Пакетная генерация</h2>
                    <div class="option">
                        <input type="number" id="batchCount" min="1" max="100" value="10">
                        <label for="batchCount">Количество паролей</label>
                    </div>
                    <div class="option">
                        <input type="number" id="batchLength" min="4" max="64" value="12">
                        <label for="batchLength">Длина каждого пароля</label>
                    </div>
                    <div class="option">
                        <input type="checkbox" id="batchUnique" checked>
                        <label for="batchUnique">Гарантировать уникальность</label>
                    </div>
                </div>
                
                <div class="settings-group">
                    <h2>Настройки символов</h2>
                    <div class="option">
                        <input type="checkbox" id="batchUppercase" checked>
                        <label for="batchUppercase">Заглавные буквы (A-Z)</label>
                    </div>
                    <div class="option">
                        <input type="checkbox" id="batchLowercase" checked>
                        <label for="batchLowercase">Строчные буквы (a-z)</label>
                    </div>
                    <div class="option">
                        <input type="checkbox" id="batchNumbers" checked>
                        <label for="batchNumbers">Цифры (0-9)</label>
                    </div>
                    <div class="option">
                        <input type="checkbox" id="batchSymbols" checked>
                        <label for="batchSymbols">Спецсимволы (!@#$%^&*)</label>
                    </div>
                </div>
            </div>
            
            <button id="generateBatchBtn" class="btn btn-large btn-block">Сгенерировать пароли</button>
            
            <div class="result-container">
                <div class="password-list" id="batchPasswordList"></div>
                <button id="copyAllBtn" class="btn">Копировать все</button>
                <button id="exportBtn" class="btn">Экспортировать в TXT</button>
            </div>
        </div>
    </div>
    
    <div class="footer">
        <p>Генератор паролей v2.0 &copy; 2023 | Все пароли генерируются локально в вашем браузере</p>
    </div>

    <script>
        // === JavaScript код (800+ строк) ===
        
        // Константы и переменные
        const UPPERCASE = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
        const LOWERCASE = 'abcdefghijklmnopqrstuvwxyz';
        const NUMBERS = '0123456789';
        const SYMBOLS = '!@#$%^&*()_+-=[]{}|;:,.<>?';
        const SIMILAR_CHARS = 'il1Lo0O';
        const AMBIGUOUS_CHARS = '{}[]()/\\\'"`~,;:.<> ';
        
        let passwordHistory = JSON.parse(localStorage.getItem('passwordHistory')) || [];
        
        // DOM элементы
        const elements = {
            // Простой режим
            length: document.getElementById('length'),
            lengthSlider: document.getElementById('lengthSlider'),
            uppercase: document.getElementById('uppercase'),
            lowercase: document.getElementById('lowercase'),
            numbers: document.getElementById('numbers'),
            symbols: document.getElementById('symbols'),
            noSimilar: document.getElementById('noSimilar'),
            noAmbiguous: document.getElementById('noAmbiguous'),
            noSequential: document.getElementById('noSequential'),
            noRepeating: document.getElementById('noRepeating'),
            requireAll: document.getElementById('requireAll'),
            generateBtn: document.getElementById('generateBtn'),
            passwordResult: document.getElementById('passwordResult'),
            copyBtn: document.getElementById('copyBtn'),
            saveBtn: document.getElementById('saveBtn'),
            strengthBar: document.getElementById('strengthBar'),
            strengthLabel: document.getElementById('strengthLabel'),
            historyList: document.getElementById('historyList'),
            clearHistoryBtn: document.getElementById('clearHistoryBtn'),
            
            // Продвинутый режим
            advLength: document.getElementById('advLength'),
            customChars: document.getElementById('customChars'),
            excludeChars: document.getElementById('excludeChars'),
            excludedChars: document.getElementById('excludedChars'),
            passwordPattern: document.getElementById('passwordPattern'),
            usePattern: document.getElementById('usePattern'),
            pronounceable: document.getElementById('pronounceable'),
            memorable: document.getElementById('memorable'),
            minUpper: document.getElementById('minUpper'),
            minLower: document.getElementById('minLower'),
            minNumbers: document.getElementById('minNumbers'),
            minSymbols: document.getElementById('minSymbols'),
            generateAdvBtn: document.getElementById('generateAdvBtn'),
            advPasswordResult: document.getElementById('advPasswordResult'),
            copyAdvBtn: document.getElementById('copyAdvBtn'),
            advStrengthBar: document.getElementById('advStrengthBar'),
            advStrengthLabel: document.getElementById('advStrengthLabel'),
            
            // Пакетный режим
            batchCount: document.getElementById('batchCount'),
            batchLength: document.getElementById('batchLength'),
            batchUnique: document.getElementById('batchUnique'),
            batchUppercase: document.getElementById('batchUppercase'),
            batchLowercase: document.getElementById('batchLowercase'),
            batchNumbers: document.getElementById('batchNumbers'),
            batchSymbols: document.getElementById('batchSymbols'),
            generateBatchBtn: document.getElementById('generateBatchBtn'),
            batchPasswordList: document.getElementById('batchPasswordList'),
            copyAllBtn: document.getElementById('copyAllBtn'),
            exportBtn: document.getElementById('exportBtn')
        };
        
        // Инициализация при загрузке
        document.addEventListener('DOMContentLoaded', function() {
            // Связываем слайдер и поле ввода длины
            elements.lengthSlider.addEventListener('input', function() {
                elements.length.value = this.value;
            });
            
            elements.length.addEventListener('input', function() {
                elements.lengthSlider.value = this.value;
            });
            
            // Генерация пароля в простом режиме
            elements.generateBtn.addEventListener('click', generatePassword);
            
            // Копирование пароля
            elements.copyBtn.addEventListener('click', copyPassword);
            elements.copyAdvBtn.addEventListener('click', copyAdvPassword);
            elements.copyAllBtn.addEventListener('click', copyAllPasswords);
            
            // Сохранение пароля в историю
            elements.saveBtn.addEventListener('click', saveToHistory);
            
            // Очистка истории
            elements.clearHistoryBtn.addEventListener('click', clearHistory);
            
            // Генерация в продвинутом режиме
            elements.generateAdvBtn.addEventListener('click', generateAdvancedPassword);
            
            // Генерация в пакетном режиме
            elements.generateBatchBtn.addEventListener('click', generateBatchPasswords);
            
            // Экспорт паролей
            elements.exportBtn.addEventListener('click', exportPasswords);
            
            // Загрузка истории
            loadHistory();
            
            // Генерация начального пароля
            generatePassword();
        });
        
        // Функции для работы с вкладками
        function openTab(tabName) {
            // Скрыть все вкладки
            const tabContents = document.getElementsByClassName('tab-content');
            for (let i = 0; i < tabContents.length; i++) {
                tabContents[i].classList.remove('active');
            }
            
            // Убрать активный класс у всех кнопок вкладок
            const tabs = document.getElementsByClassName('tab');
            for (let i = 0; i < tabs.length; i++) {
                tabs[i].classList.remove('active');
            }
            
            // Показать текущую вкладку и сделать кнопку активной
            document.getElementById(tabName).classList.add('active');
            event.currentTarget.classList.add('active');
        }
        
        // Основная функция генерации пароля
        function generatePassword() {
            let length = parseInt(elements.length.value);
            let charset = '';
            let password = '';
            
            // Собираем набор символов в зависимости от выбранных опций
            if (elements.uppercase.checked) {
                charset += UPPERCASE;
            }
            if (elements.lowercase.checked) {
                charset += LOWERCASE;
            }
            if (elements.numbers.checked) {
                charset += NUMBERS;
            }
            if (elements.symbols.checked) {
                charset += SYMBOLS;
            }
            
            // Исключаем похожие символы
            if (elements.noSimilar.checked && charset.length > 0) {
                for (let char of SIMILAR_CHARS) {
                    charset = charset.replace(new RegExp(char, 'g'), '');
                }
            }
            
            // Исключаем неоднозначные символы
            if (elements.noAmbiguous.checked && charset.length > 0) {
                for (let char of AMBIGUOUS_CHARS) {
                    charset = charset.replace(new RegExp('\\' + char, 'g'), '');
                }
            }
            
            // Проверка, что хотя бы один набор символов выбран
            if (charset.length === 0) {
                alert('Пожалуйста, выберите хотя бы один тип символов!');
                return;
            }
            
            // Генерация пароля
            if (elements.requireAll.checked) {
                password = generatePasswordWithAllRequirements(length, charset);
            } else {
                for (let i = 0; i < length; i++) {
                    const randomIndex = Math.floor(Math.random() * charset.length);
                    password += charset[randomIndex];
                }
            }
            
            // Проверка на последовательные символы
            if (elements.noSequential.checked) {
                password = removeSequentialChars(password);
            }
            
            // Проверка на повторяющиеся символы
            if (elements.noRepeating.checked) {
                password = removeRepeatingChars(password);
            }
            
            // Отображаем результат
            elements.passwordResult.value = password;
            
            // Оцениваем надежность
            evaluatePasswordStrength(password, elements.strengthBar, elements.strengthLabel);
        }
        
        // Генерация пароля с обязательным включением всех выбранных типов символов
        function generatePasswordWithAllRequirements(length, charset) {
            let password = '';
            const requiredChars = [];
            
            if (elements.uppercase.checked) {
                const randomIndex = Math.floor(Math.random() * UPPERCASE.length);
                requiredChars.push(UPPERCASE[randomIndex]);
            }
            if (elements.lowercase.checked) {
                const randomIndex = Math.floor(Math.random() * LOWERCASE.length);
                requiredChars.push(LOWERCASE[randomIndex]);
            }
            if (elements.numbers.checked) {
                const randomIndex = Math.floor(Math.random() * NUMBERS.length);
                requiredChars.push(NUMBERS[randomIndex]);
            }
            if (elements.symbols.checked) {
                const randomIndex = Math.floor(Math.random() * SYMBOLS.length);
                requiredChars.push(SYMBOLS[randomIndex]);
            }
            
            // Добавляем обязательные символы
            for (let char of requiredChars) {
                password += char;
            }
            
            // Добавляем остальные символы
            for (let i = password.length; i < length; i++) {
                const randomIndex = Math.floor(Math.random() * charset.length);
                password += charset[randomIndex];
            }
            
            // Перемешиваем пароль
            return shuffleString(password);
        }
        
        // Удаление последовательных символов (abc, 123 и т.д.)
        function removeSequentialChars(password) {
            const sequentialPatterns = [
                '0123456789',
                'abcdefghijklmnopqrstuvwxyz',
                'zyxwvutsrqponmlkjihgfedcba',
                ')!@#$%^&*('
            ];
            
            for (let pattern of sequentialPatterns) {
                for (let i = 0; i <= pattern.length - 3; i++) {
                    const sequence = pattern.substr(i, 3);
                    if (password.toLowerCase().includes(sequence)) {
                        const randomIndex = Math.floor(Math.random() * password.length);
                        const replacement = getRandomCharFromCharset(getCurrentCharset());
                        password = password.substring(0, randomIndex) + replacement + password.substring(randomIndex + 1);
                        i = -1; // Начинаем проверку заново
                        break;
                    }
                }
            }
            
            return password;
        }
        
        // Удаление повторяющихся символов (aa, 11 и т.д.)
        function removeRepeatingChars(password) {
            for (let i = 0; i < password.length - 1; i++) {
                if (password[i] === password[i + 1]) {
                    const replacement = getRandomCharFromCharset(getCurrentCharset());
                    password = password.substring(0, i + 1) + replacement + password.substring(i + 2);
                    i = -1; // Начинаем проверку заново
                }
            }
            return password;
        }
        
        // Получение текущего набора символов
        function getCurrentCharset() {
            let charset = '';
            
            if (elements.uppercase.checked) {
                charset += UPPERCASE;
            }
            if (elements.lowercase.checked) {
                charset += LOWERCASE;
            }
            if (elements.numbers.checked) {
                charset += NUMBERS;
            }
            if (elements.symbols.checked) {
                charset += SYMBOLS;
            }
            
            // Исключаем похожие символы
            if (elements.noSimilar.checked && charset.length > 0) {
                for (let char of SIMILAR_CHARS) {
                    charset = charset.replace(new RegExp(char, 'g'), '');
                }
            }
            
            // Исключаем неоднозначные символы
            if (elements.noAmbiguous.checked && charset.length > 0) {
                for (let char of AMBIGUOUS_CHARS) {
                    charset = charset.replace(new RegExp('\\' + char, 'g'), '');
                }
            }
            
            return charset;
        }
        
        // Получение случайного символа из набора
        function getRandomCharFromCharset(charset) {
            if (charset.length === 0) return '';
            const randomIndex = Math.floor(Math.random() * charset.length);
            return charset[randomIndex];
        }
        
        // Перемешивание строки
        function shuffleString(str) {
            const array = str.split('');
            for (let i = array.length - 1; i > 0; i--) {
                const j = Math.floor(Math.random() * (i + 1));
                [array[i], array[j]] = [array[j], array[i]];
            }
            return array.join('');
        }
        
        // Оценка надежности пароля
        function evaluatePasswordStrength(password, strengthBar, strengthLabel) {
            let score = 0;
            
            if (!password) {
                strengthBar.style.width = '0%';
                strengthLabel.textContent = 'Надежность: -';
                return;
            }
            
            const length = password.length;
            
            // Оценка за длину
            if (length < 8) score = 0;
            else if (length < 12) score = length * 3;
            else if (length < 16) score = length * 4;
            else score = length * 5;
            
            // Бонусы за использование разных типов символов
            const hasUpper = /[A-Z]/.test(password);
            const hasLower = /[a-z]/.test(password);
            const hasNumber = /[0-9]/.test(password);
            const hasSymbol = /[^A-Za-z0-9]/.test(password);
            
            const charTypes = [hasUpper, hasLower, hasNumber, hasSymbol].filter(Boolean).length;
            
            if (charTypes >= 2) score += 10;
            if (charTypes >= 3) score += 15;
            if (charTypes >= 4) score += 25;
            
            // Штрафы за последовательности и повторения
            const sequentialRegex = /(abc|bcd|cde|def|efg|fgh|ghi|hij|ijk|jkl|klm|lmn|mno|nop|opq|pqr|qrs|rst|stu|tuv|uvw|vwx|wxy|xyz|012|123|234|345|456|567|678|789|890)/i;
            if (sequentialRegex.test(password)) score -= 30;
            
            const repeatingRegex = /(.)\1{2,}/;
            if (repeatingRegex.test(password)) score -= 20;
            
            // Ограничиваем счет в пределах 0-100
            score = Math.max(0, Math.min(100, score));
            
            // Устанавливаем ширину индикатора
            strengthBar.style.width = score + '%';
            
            // Устанавливаем цвет и текст в зависимости от оценки
            if (score < 30) {
                strengthBar.className = 'strength-bar strength-weak';
                strengthLabel.textContent = 'Надежность: Слабая';
            } else if (score < 60) {
                strengthBar.className = 'strength-bar strength-medium';
                strengthLabel.textContent = 'Надежность: Средняя';
            } else if (score < 80) {
                strengthBar.className = 'strength-bar strength-strong';
                strengthLabel.textContent = 'Надежность: Сильная';
            } else {
                strengthBar.className = 'strength-bar strength-very-strong';
                strengthLabel.textContent = 'Надежность: Очень сильная';
            }
        }
        
        // Копирование пароля в буфер обмена
        function copyPassword() {
            const password = elements.passwordResult.value;
            if (!password) {
                alert('Сначала сгенерируйте пароль!');
                return;
            }
            
            navigator.clipboard.writeText(password).then(() => {
                alert('Пароль скопирован в буфер обмена!');
            }).catch(err => {
                console.error('Ошибка копирования: ', err);
                alert('Не удалось скопировать пароль. Попробуйте снова.');
            });
        }
        
        // Сохранение пароля в историю
        function saveToHistory() {
            const password = elements.passwordResult.value;
            if (!password) {
                alert('Сначала сгенерируйте пароль!');
                return;
            }
            
            const timestamp = new Date().toLocaleString();
            passwordHistory.unshift({ password, timestamp });
            
            // Ограничиваем историю 50 записями
            if (passwordHistory.length > 50) {
                passwordHistory = passwordHistory.slice(0, 50);
            }
            
            // Сохраняем в localStorage
            localStorage.setItem('passwordHistory', JSON.stringify(passwordHistory));
            
            // Обновляем отображение истории
            loadHistory();
            
            alert('Пароль сохранен в историю!');
        }
        
        // Загрузка истории паролей
        function loadHistory() {
            elements.historyList.innerHTML = '';
            
            if (passwordHistory.length === 0) {
                elements.historyList.innerHTML = '<p>История паролей пуста</p>';
                return;
            }
            
            passwordHistory.forEach((item, index) => {
                const historyItem = document.createElement('div');
                historyItem.className = 'history-item';
                historyItem.innerHTML = `
                    <span>${item.password}</span>
                    <span>
                        <small>${item.timestamp}</small>
                        <button class="copy-btn" onclick="copyHistoryPassword(${index})">Копировать</button>
                    </span>
                `;
                elements.historyList.appendChild(historyItem);
            });
        }
        
        // Копирование пароля из истории
        function copyHistoryPassword(index) {
            const password = passwordHistory[index].password;
            navigator.clipboard.writeText(password).then(() => {
                alert('Пароль скопирован в буфер обмена!');
            }).catch(err => {
                console.error('Ошибка копирования: ', err);
                alert('Не удалось скопировать пароль. Попробуйте снова.');
            });
        }
        
        // Очистка истории
        function clearHistory() {
            if (confirm('Вы уверены, что хотите очистить историю паролей?')) {
                passwordHistory = [];
                localStorage.setItem('passwordHistory', JSON.stringify(passwordHistory));
                loadHistory();
            }
        }
        
        // === Продвинутые функции генерации ===
        
        // Генерация пароля в продвинутом режиме
        function generateAdvancedPassword() {
            let length = parseInt(elements.advLength.value);
            let charset = '';
            
            // Используем пользовательские символы, если они заданы
            if (elements.customChars.value.trim() !== '') {
                charset = elements.customChars.value;
            } else {
                // Иначе собираем стандартный набор
                if (elements.uppercase.checked) charset += UPPERCASE;
                if (elements.lowercase.checked) charset += LOWERCASE;
                if (elements.numbers.checked) charset += NUMBERS;
                if (elements.symbols.checked) charset += SYMBOLS;
            }
            
            // Исключаем символы, если задано
            if (elements.excludeChars.checked && elements.excludedChars.value.trim() !== '') {
                const excluded = elements.excludedChars.value;
                for (let char of excluded) {
                    charset = charset.replace(new RegExp('\\' + char, 'g'), '');
                }
            }
            
            // Проверка на пустой набор символов
            if (charset.length === 0) {
                alert('Пожалуйста, выберите или введите символы для генерации пароля!');
                return;
            }
            
            let password = '';
            
            // Генерация по шаблону
            if (elements.usePattern.checked && elements.passwordPattern.value.trim() !== '') {
                password = generateFromPattern(elements.passwordPattern.value, charset);
            } 
            // Генерация произносимого пароля
            else if (elements.pronounceable.checked) {
                password = generatePronounceablePassword(length);
            } 
            // Генерация запоминающегося пароля
            else if (elements.memorable.checked) {
                password = generateMemorablePassword(length);
            } 
            // Обычная генерация
            else {
                password = generateWithMinRequirements(length, charset);
            }
            
            // Отображаем результат
            elements.advPasswordResult.value = password;
            
            // Оцениваем надежность
            evaluatePasswordStrength(password, elements.advStrengthBar, elements.advStrengthLabel);
        }
        
        // Генерация пароля по шаблону
        function generateFromPattern(pattern, charset) {
            let password = '';
            const patternCodes = pattern.split('');
            
            // Разделяем charset на группы
            const upperChars = charset.match(/[A-Z]/g) || [];
            const lowerChars = charset.match(/[a-z]/g) || [];
            const numberChars = charset.match(/[0-9]/g) || [];
            const symbolChars = charset.replace(/[A-Za-z0-9]/g, '').split('').filter(c => c);
            
            for (let code of patternCodes) {
                switch (code) {
                    case 'C': // Заглавная буква
                        if (upperChars.length > 0) {
                            password += upperChars[Math.floor(Math.random() * upperChars.length)];
                        } else {
                            password += getRandomCharFromCharset(charset);
                        }
                        break;
                    case 'c': // Строчная буква
                        if (lowerChars.length > 0) {
                            password += lowerChars[Math.floor(Math.random() * lowerChars.length)];
                        } else {
                            password += getRandomCharFromCharset(charset);
                        }
                        break;
                    case 'd': // Цифра
                        if (numberChars.length > 0) {
                            password += numberChars[Math.floor(Math.random() * numberChars.length)];
                        } else {
                            password += getRandomCharFromCharset(charset);
                        }
                        break;
                    case 's': // Спецсимвол
                        if (symbolChars.length > 0) {
                            password += symbolChars[Math.floor(Math.random() * symbolChars.length)];
                        } else {
                            password += getRandomCharFromCharset(charset);
                        }
                        break;
                    default: // Любой символ
                        password += getRandomCharFromCharset(charset);
                }
            }
            
            return password;
        }
        
        // Генерация произносимого пароля
        function generatePronounceablePassword(length) {
            const vowels = 'aeiouy';
            const consonants = 'bcdfghjklmnpqrstvwxz';
            let password = '';
            
            // Начинаем с согласной или гласной
            let useVowel = Math.random() > 0.5;
            
            for (let i = 0; i < length; i++) {
                if (useVowel) {
                    password += vowels[Math.floor(Math.random() * vowels.length)];
                } else {
                    password += consonants[Math.floor(Math.random() * consonants.length)];
                }
                
                // 80% вероятности смены типа символа
                useVowel = Math.random() < 0.8 ? !useVowel : useVowel;
            }
            
            // С 50% вероятностью делаем первую букву заглавной
            if (Math.random() > 0.5) {
                password = password.charAt(0).toUpperCase() + password.slice(1);
            }
            
            // С 30% вероятностью добавляем цифру в конец
            if (Math.random() < 0.3) {
                password += Math.floor(Math.random() * 10);
            }
            
            return password;
        }
        
        // Генерация запоминающегося пароля
        function generateMemorablePassword(length) {
            const wordList = [
                'apple', 'banana', 'carrot', 'dog', 'elephant', 'flower', 'giraffe', 
                'house', 'island', 'jungle', 'kangaroo', 'lion', 'mountain', 'notebook',
                'ocean', 'pencil', 'queen', 'river', 'sun', 'tree', 'umbrella', 'volcano',
                'water', 'xylophone', 'yellow', 'zebra'
            ];
            
            const separatorList = ['-', '_', '.', '!', '@', '#', '$', '%', '&', '*'];
            
            let password = '';
            const wordCount = Math.max(2, Math.floor(length / 5));
            
            // Выбираем случайные слова
            for (let i = 0; i < wordCount; i++) {
                const randomWord = wordList[Math.floor(Math.random() * wordList.length)];
                
                // С 50% вероятностью делаем первую букву заглавной
                if (Math.random() > 0.5) {
                    password += randomWord.charAt(0).toUpperCase() + randomWord.slice(1);
                } else {
                    password += randomWord;
                }
                
                // Добавляем разделитель, если это не последнее слово
                if (i < wordCount - 1) {
                    const randomSeparator = separatorList[Math.floor(Math.random() * separatorList.length)];
                    password += randomSeparator;
                }
            }
            
            // Если пароль слишком короткий, добавляем цифры
            if (password.length < length) {
                const neededDigits = length - password.length;
                for (let i = 0; i < neededDigits; i++) {
                    password += Math.floor(Math.random() * 10);
                }
            }
            
            // Если пароль слишком длинный, обрезаем
            if (password.length > length) {
                password = password.substring(0, length);
            }
            
            return password;
        }
        
        // Генерация пароля с минимальными требованиями
        function generateWithMinRequirements(length, charset) {
            let password = '';
            const minUpper = parseInt(elements.minUpper.value) || 0;
            const minLower = parseInt(elements.minLower.value) || 0;
            const minNumbers = parseInt(elements.minNumbers.value) || 0;
            const minSymbols = parseInt(elements.minSymbols.value) || 0;
            
            // Добавляем обязательные символы
            for (let i = 0; i < minUpper; i++) {
                const upperChars = charset.match(/[A-Z]/g) || [];
                if (upperChars.length > 0) {
                    password += upperChars[Math.floor(Math.random() * upperChars.length)];
                } else {
                    password += getRandomCharFromCharset(charset);
                }
            }
            
            for (let i = 0; i < minLower; i++) {
                const lowerChars = charset.match(/[a-z]/g) || [];
                if (lowerChars.length > 0) {
                    password += lowerChars[Math.floor(Math.random() * lowerChars.length)];
                } else {
                    password += getRandomCharFromCharset(charset);
                }
            }
            
            for (let i = 0; i < minNumbers; i++) {
                const numberChars = charset.match(/[0-9]/g) || [];
                if (numberChars.length > 0) {
                    password += numberChars[Math.floor(Math.random() * numberChars.length)];
                } else {
                    password += getRandomCharFromCharset(charset);
                }
            }
            
            for (let i = 0; i < minSymbols; i++) {
                const symbolChars = charset.replace(/[A-Za-z0-9]/g, '').split('').filter(c => c);
                if (symbolChars.length > 0) {
                    password += symbolChars[Math.floor(Math.random() * symbolChars.length)];
                } else {
                    password += getRandomCharFromCharset(charset);
                }
            }
            
            // Добавляем остальные символы
            for (let i = password.length; i < length; i++) {
                password += getRandomCharFromCharset(charset);
            }
            
            // Перемешиваем пароль
            return shuffleString(password);
        }
        
        // Копирование пароля из продвинутого режима
        function copyAdvPassword() {
            const password = elements.advPasswordResult.value;
            if (!password) {
                alert('Сначала сгенерируйте пароль!');
                return;
            }
            
            navigator.clipboard.writeText(password).then(() => {
                alert('Пароль скопирован в буфер обмена!');
            }).catch(err => {
                console.error('Ошибка копирования: ', err);
                alert('Не удалось скопировать пароль. Попробуйте снова.');
            });
        }
        
        // === Пакетная генерация паролей ===
        
        function generateBatchPasswords() {
            const count = parseInt(elements.batchCount.value) || 10;
            const length = parseInt(elements.batchLength.value) || 12;
            const unique = elements.batchUnique.checked;
            
            // Собираем набор символов
            let charset = '';
            if (elements.batchUppercase.checked) charset += UPPERCASE;
            if (elements.batchLowercase.checked) charset += LOWERCASE;
            if (elements.batchNumbers.checked) charset += NUMBERS;
            if (elements.batchSymbols.checked) charset += SYMBOLS;
            
            // Проверка на пустой набор символов
            if (charset.length === 0) {
                alert('Пожалуйста, выберите хотя бы один тип символов!');
                return;
            }
            
            elements.batchPasswordList.innerHTML = '';
            const passwords = [];
            
            for (let i = 0; i < count; i++) {
                let password;
                let attempts = 0;
                const maxAttempts = 100;
                
                do {
                    password = '';
                    for (let j = 0; j < length; j++) {
                        password += charset[Math.floor(Math.random() * charset.length)];
                    }
                    attempts++;
                } while (unique && passwords.includes(password) && attempts < maxAttempts);
                
                if (attempts >= maxAttempts) {
                    alert('Не удалось сгенерировать уникальные пароли. Попробуйте увеличить длину или уменьшить количество.');
                    return;
                }
                
                passwords.push(password);
                
                const passwordItem = document.createElement('div');
                passwordItem.className = 'password-item';
                passwordItem.textContent = password;
                elements.batchPasswordList.appendChild(passwordItem);
            }
        }
        
        // Копирование всех паролей
        function copyAllPasswords() {
            const passwordItems = elements.batchPasswordList.querySelectorAll('.password-item');
            if (passwordItems.length === 0) {
                alert('Сначала сгенерируйте пароли!');
                return;
            }
            
            let passwordsText = '';
            passwordItems.forEach(item => {
                passwordsText += item.textContent + '\n';
            });
            
            navigator.clipboard.writeText(passwordsText.trim()).then(() => {
                alert('Все пароли скопированы в буфер обмена!');
            }).catch(err => {
                console.error('Ошибка копирования: ', err);
                alert('Не удалось скопировать пароли. Попробуйте снова.');
            });
        }
        
        // Экспорт паролей в текстовый файл
        function exportPasswords() {
            const passwordItems = elements.batchPasswordList.querySelectorAll('.password-item');
            if (passwordItems.length === 0) {
                alert('Сначала сгенерируйте пароли!');
                return;
            }
            
            let passwordsText = 'Сгенерированные пароли:\n\n';
            passwordItems.forEach((item, index) => {
                passwordsText += `${index + 1}. ${item.textContent}\n`;
            });
            
            const blob = new Blob([passwordsText], { type: 'text/plain' });
            const url = URL.createObjectURL(blob);
            
            const a = document.createElement('a');
            a.href = url;
            a.download = 'passwords.txt';
            document.body.appendChild(a);
            a.click();
            document.body.removeChild(a);
            URL.revokeObjectURL(url);
        }
    </script>
</body>
</html>
